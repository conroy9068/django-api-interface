{% extends 'layouts/base.html' %} {% load static %} {% block content %}

<!-- [ Main Content ] start -->
<div class="row">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header">
        <h5>Address Validation</h5>
      </div>
      <div class="card-block">
        <div class="container my-5 py-5">
          <div
            id="form-container"
            class="container my-5 py-5"
            style="display: {% if result %}none{% else %}block{% endif %};"
          >
            <h1 class="mb-3">Address Validate</h1>
            <form method="post" id="address-validate-form">
              {% csrf_token %} {% for field in form %}
              <div
                class="{% if field.errors %}has-error{% else %}mb-3{% endif %}"
              >
                <label class="form-label" for="{{ field.id_for_label }}"
                  >{{ field.label }}</label
                >
                {{ field }}
              </div>
              {% for error in field.errors %}
              <div
                class="invalid-feedback {% if forloop.last %}mb-3{% else %}mb-1{% endif %}"
              >
                {{ error }}
              </div>
              {% endfor %} {% endfor %}
              <button class="btn btn-primary" type="submit">Submit</button>
            </form>
          </div>

          <div
            id="result-container"
            class="container my-5 py-5"
            style="display: {% if result %}block{% else %}none{% endif %};"
          >
            <h1 class="mb-3">Validation Result</h1>
            {% if result %}
            <div id="response-container" class="mb-3"></div>
            <button class="btn btn-secondary" onclick="showForm()">
              Back to Form
            </button>
            <script>
              const response = {{ result|safe }};
              const container = document.getElementById("response-container");

              if (response.warnings) {
                  const warnings = document.createElement("div");
                  warnings.className = "alert alert-warning";
                  warnings.textContent = response.warnings.join(", ");
                  container.appendChild(warnings);
              }

              if (response.address) {
                  response.address.forEach(addr => {
                      const addressDiv = document.createElement("div");
                      addressDiv.className = "alert alert-info";
                      addressDiv.innerHTML = `
                          <strong>Country Code:</strong> ${addr.countryCode}<br>
                          <strong>Postal Code:</strong> ${addr.postalCode}<br>
                          <strong>City Name:</strong> ${addr.cityName}<br>
                          <strong>County Name:</strong> ${addr.countyName}<br>
                          <strong>Service Area Code:</strong> ${addr.serviceArea.code}<br>
                          <strong>Service Area Description:</strong> ${addr.serviceArea.description}<br>
                          <strong>Service Area GMT Offset:</strong> ${addr.serviceArea.GMTOffset}
                      `;
                      container.appendChild(addressDiv);
                  });
              }

              function showForm() {
                  document.getElementById("form-container").style.display = "block";
                  document.getElementById("result-container").style.display = "none";
              }
            </script>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- [ Main Content ] end -->

{% endblock content %}
